var ngMap=angular.module("ngMap",[]);ngMap.service("Attr2Options",["$parse","NavigatorGeolocation","GeoCoder",function($parse,NavigatorGeolocation,GeoCoder){var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,orgAttributes=function(e){e.length>0&&(e=e[0]);for(var t={},n=0;n<e.attributes.length;n++){var o=e.attributes[n];t[o.name]=o.value}return t},camelCase=function(e){return e.replace(SPECIAL_CHARS_REGEXP,function(e,t,n,o){return o?n.toUpperCase():n}).replace(MOZ_HACK_REGEXP,"Moz$1")},JSONize=function(e){try{return JSON.parse(e),e}catch(t){return e.replace(/([\$\w]+)\s*:/g,function(e,t){return'"'+t+'":'}).replace(/'([^']+)'/g,function(e,t){return'"'+t+'"'})}},toOptionValue=function(input,options){var output,key=options.key,scope=options.scope;try{var num=Number(input);if(isNaN(num))throw"Not a number";output=num}catch(err){try{if(input.match(/^[\+\-]?[0-9\.]+,[ ]*\ ?[\+\-]?[0-9\.]+$/)&&(input="["+input+"]"),output=JSON.parse(JSONize(input)),output instanceof Array){var t1stEl=output[0];if(t1stEl.constructor==Object);else if(t1stEl.constructor==Array)output=output.map(function(e){return new google.maps.LatLng(e[0],e[1])});else if(!isNaN(parseFloat(t1stEl))&&isFinite(t1stEl))return new google.maps.LatLng(output[0],output[1])}}catch(err2){if(input.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/))try{var exp="new google.maps."+input;output=eval(exp)}catch(e){output=input}else if(input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/))try{var matches=input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/);output=google.maps[matches[1]][matches[2]]}catch(e){output=input}else if(input.match(/^[A-Z]+$/))try{var capitalizedKey=key.charAt(0).toUpperCase()+key.slice(1);key.match(/temperatureUnit|windSpeedUnit|labelColor/)?(capitalizedKey=capitalizedKey.replace(/s$/,""),output=google.maps.weather[capitalizedKey][input]):output=google.maps[capitalizedKey][input]}catch(e){output=input}else output=input}}return output},setDelayedGeoLocation=function(e,t,n,o){o=o||{};var r=e.centered||o.centered,a=function(){var n=o.fallbackLocation||new google.maps.LatLng(0,0);e[t](n)};!n||n.match(/^current/i)?NavigatorGeolocation.getCurrentPosition().then(function(n){var a=n.coords.latitude,i=n.coords.longitude,s=new google.maps.LatLng(a,i);e[t](s),r&&e.map.setCenter(s),o.callback&&o.callback.apply(e)},a):GeoCoder.geocode({address:n}).then(function(n){e[t](n[0].geometry.location),r&&e.map.setCenter(n[0].geometry.location)},a)},getAttrsToObserve=function(e){var t=[];if(e["ng-repeat"]||e.ngRepeat);else for(var n in e){var o=e[n];o&&o.match(/\{\{.*\}\}/)&&t.push(camelCase(n))}return t},observeAttrSetObj=function(e,t,n){var o=getAttrsToObserve(e);Object.keys(o).length;for(var r=0;r<o.length;r++)observeAndSet(t,o[r],n)},observeAndSet=function(e,t,n){e.$observe(t,function(e){if(e){var o=camelCase("set-"+t),r=toOptionValue(e,{key:t});n[o]&&(t.match(/center|position/)&&"string"==typeof r?setDelayedGeoLocation(n,o,r):n[o](r))}})};return{filter:function(e){var t={};for(var n in e)n.match(/^\$/)||n.match(/^ng[A-Z]/)||(t[n]=e[n]);return t},getOptions:function(e,t){var n={};for(var o in e)if(e[o]){if(o.match(/^on[A-Z]/))continue;if(o.match(/ControlOptions$/))continue;n[o]=toOptionValue(e[o],{scope:t,key:o})}return n},getEvents:function(e,t){var n={},o=function(e){return"_"+e.toLowerCase()},r=function(t){var n=t.match(/([^\(]+)\(([^\)]*)\)/),o=n[1],r=n[2].replace(/event[ ,]*/,""),a=e.$eval("["+r+"]");return function(t){e[o].apply(this,[t].concat(a)),e.$apply()}};for(var a in t)if(t[a]){if(!a.match(/^on[A-Z]/))continue;var i=a.replace(/^on/,"");i=i.charAt(0).toLowerCase()+i.slice(1),i=i.replace(/([A-Z])/g,o);var s=t[a];n[i]=new r(s)}return n},getControlOptions:function(e){var t={};if("object"!=typeof e)return!1;for(var n in e)if(e[n]){if(!n.match(/(.*)ControlOptions$/))continue;var o=e[n],r=o.replace(/'/g,'"');r=r.replace(/([^"]+)|("[^"]+")/g,function(e,t,n){return t?t.replace(/([a-zA-Z0-9]+?):/g,'"$1":'):n});try{var a=JSON.parse(r);for(var i in a)if(a[i]){var s=a[i];if("string"==typeof s?s=s.toUpperCase():"mapTypeIds"===i&&(s=s.map(function(e){return e.match(/^[A-Z]+$/)?google.maps.MapTypeId[e.toUpperCase()]:e})),"style"===i){var p=n.charAt(0).toUpperCase()+n.slice(1),l=p.replace(/Options$/,"")+"Style";a[i]=google.maps[l][s]}else a[i]="position"===i?google.maps.ControlPosition[s]:s}t[n]=a}catch(c){}}return t},toOptionValue:toOptionValue,camelCase:camelCase,setDelayedGeoLocation:setDelayedGeoLocation,getAttrsToObserve:getAttrsToObserve,observeAndSet:observeAndSet,observeAttrSetObj:observeAttrSetObj,orgAttributes:orgAttributes}}]),ngMap.service("GeoCoder",["$q",function(e){return{geocode:function(t){var n=e.defer(),o=new google.maps.Geocoder;return o.geocode(t,function(e,t){t==google.maps.GeocoderStatus.OK?n.resolve(e):n.reject("Geocoder failed due to: "+t)}),n.promise}}}]),ngMap.service("NavigatorGeolocation",["$q",function(e){return{getCurrentPosition:function(){var t=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject("Browser Geolocation service failed."),t.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}}]),ngMap.service("StreetView",["$q",function(e){return{getPanorama:function(t,n){n=n||t.getCenter();var o=e.defer(),r=new google.maps.StreetViewService;return r.getPanoramaByLocation(n||t.getCenter,100,function(e,t){t===google.maps.StreetViewStatus.OK?o.resolve(e.location.pano):o.resolve(!1)}),o.promise},setPanorama:function(e,t){var n=new google.maps.StreetViewPanorama(e.getDiv(),{enableCloseButton:!0});n.setPano(t)}}}]),ngMap.directive("bicyclingLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.BicyclingLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(o),p=t.filter(r),l=t.getOptions(p),c=t.getEvents(e,p),g=n(l,c);mapController.addObject("bicyclingLayers",g),t.observeAttrSetObj(s,r,g)}}}]),ngMap.directive("cloudLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.CloudLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(o),p=t.filter(r),l=t.getOptions(p),c=t.getEvents(e,p),g=n(l,c);mapController.addObject("cloudLayers",g),t.observeAttrSetObj(s,r,g)}}}]),ngMap.directive("customControl",["Attr2Options","$compile",function(e,t){var n=e;return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);o.css("display","none");var s=(n.orgAttributes(o),n.filter(r)),p=n.getOptions(s,e),l=n.getEvents(e,s),c=t(o.html().trim())(e),g=c[0];for(var u in l)google.maps.event.addDomListener(g,u,l[u]);mapController.addObject("customControls",g),e.$on("mapInitialized",function(e,t){var n=p.position;t.controls[google.maps.ControlPosition[n]].push(g)})}}}]),ngMap.directive("dynamicMapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.DynamicMapsEngineLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.filter(r),p=t.getOptions(s),l=t.getEvents(e,s,l),c=n(p,l);mapController.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("fusionTablesLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.FusionTablesLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.filter(r),p=t.getOptions(s),l=t.getEvents(e,s,l),c=n(p,l);mapController.addObject("fusionTablesLayers",c)}}}]),ngMap.directive("heatmapLayer",["Attr2Options","$window",function(e,t){var n=e;return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=n.filter(r),p=n.getOptions(s);if(p.data=t[r.data]||e[r.data],!(p.data instanceof Array))throw"invalid heatmap data";p.data=new google.maps.MVCArray(p.data);{var l=new google.maps.visualization.HeatmapLayer(p);n.getEvents(e,s)}mapController.addObject("heatmapLayers",l)}}}]),ngMap.directive("infoWindow",["Attr2Options","$compile","$timeout",function(Attr2Options,$compile,$timeout){var parser=Attr2Options,getInfoWindow=function(options,events,element){var infoWindow;if(!options.position||options.position instanceof google.maps.LatLng)infoWindow=new google.maps.InfoWindow(options);else{var address=options.position;delete options.position,infoWindow=new google.maps.InfoWindow(options);var callback=function(){infoWindow.open(infoWindow.map)};parser.setDelayedGeoLocation(infoWindow,"setPosition",address,{callback:callback})}Object.keys(events).length>0;for(var eventName in events)eventName&&google.maps.event.addListener(infoWindow,eventName,events[eventName]);var template=element.html().trim();if(1!=angular.element(template).length)throw"info-window working as a template must have a container";return infoWindow.__template=template.replace(/\s?ng-non-bindable[='"]+/,""),infoWindow.__compile=function(e){var t=$compile(infoWindow.__template)(e);e.$apply(),infoWindow.setContent(t[0])},infoWindow.__eval=function(event){var template=infoWindow.__template,_this=this;return template=template.replace(/{{(event|this)[^;\}]+}}/g,function(match){var expression=match.replace(/[{}]/g,"").replace("this.","_this.");return eval(expression)})},infoWindow};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,t,n,o){for(var r=0;r<o.length;r++)o[r]&&(mapController=o[r]);t.css("display","none");var a=parser.orgAttributes(t),i=parser.filter(n),s=parser.getOptions(i,e),p=parser.getEvents(e,i),l=getInfoWindow(s,p,t);mapController.addObject("infoWindows",l),parser.observeAttrSetObj(a,n,l),l.visible&&e.$on("mapInitialized",function(t,n){$timeout(function(){l.__template=l.__eval.apply(this,[t]),l.__compile(e),l.map=n,l.position&&l.open(n)})}),l.visibleOnMarker&&e.$on("mapInitialized",function(t,n){$timeout(function(){var o=l.visibleOnMarker,r=n.markers[o];if(!r)throw"Invalid marker id";l.__template=l.__eval.apply(this,[t]),l.__compile(e),l.open(n,r)})}),e.showInfoWindow=e.showInfoWindow||function(t,n,o){var r=mapController.map.infoWindows[n];r.__template=r.__eval.apply(this,[t]),r.__compile(e),o?r.open(mapController.map,o):this.getPosition?r.open(mapController.map,this):r.open(mapController.map)}}}}]),ngMap.directive("kmlLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.KmlLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(o),p=t.filter(r),l=t.getOptions(p),c=t.getEvents(e,p),g=n(l,c);mapController.addObject("kmlLayers",g),t.observeAttrSetObj(s,r,g)}}}]),ngMap.directive("mapData",["Attr2Options",function(e){var t=e;return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,n,o,r){for(var a=0;a<r.length;a++)r[a]&&(mapController=r[a]);var i=t.filter(o),s=t.getOptions(i),p=t.getEvents(e,i,p);e.$on("mapInitialized",function(t,n){for(var o in s)if(o){var r=s[o];"function"==typeof e[r]?n.data[o](e[r]):n.data[o](r)}for(var a in p)p[a]&&n.data.addListener(a,p[a])})}}}]),ngMap.directive("mapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,n,o,r){for(var a=0;a<r.length;a++)r[a]&&(mapController=r[a]);var i,s=o.name;if(!s)throw"invalid map-type name";if(o.object){var p=e[o.object]?e:t;i=p[o.object],"function"==typeof i&&(i=new i)}if(!i)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){t.mapTypes.set(s,i)}),mapController.addObject("mapTypes",i)}}}]),function(){var e=function(e,t){function n(e,t){if(e.currentStyle)var n=e.currentStyle[t];else if(window.getComputedStyle)var n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t);return n}var o=e;return{restrict:"AE",controller:ngMap.MapController,link:function(r,a,i,s){var p=o.orgAttributes(a);r.google=google;var l=document.createElement("div");l.style.width="100%",l.style.height="100%",a.prepend(l),"block"!=n(a[0],"display")&&a.css("display","block"),n(a[0],"height").match(/^0/)&&a.css("height","300px");var c=function(n,a){var c=new google.maps.Map(l,{});c.markers={},c.shapes={},t(function(){google.maps.event.trigger(c,"resize")}),n.zoom=n.zoom||15;var g=n.center;g?g instanceof google.maps.LatLng||(delete n.center,e.setDelayedGeoLocation(c,"setCenter",g,{fallbackLocation:u.geoFallbackCenter})):n.center=new google.maps.LatLng(0,0),c.setOptions(n);for(var m in a)m&&google.maps.event.addListener(c,m,a[m]);o.observeAttrSetObj(p,i,c),s.map=c,s.addObjects(s._objects),r.map=c,r.map.scope=r,r.$emit("mapInitialized",c),r.maps=r.maps||{},r.maps[u.id||Object.keys(r.maps).length]=c,r.$emit("mapsInitialized",r.maps)},g=o.filter(i),u=o.getOptions(g,r),m=o.getControlOptions(g),v=angular.extend(u,m),f=o.getEvents(r,g);i.initEvent?r.$on(i.initEvent,function(){!s.map&&c(v,f)}):c(v,f)}}};ngMap.directive("ngMap",["Attr2Options","$timeout",e]),ngMap.directive("map",["Attr2Options","$timeout",e])}(),ngMap.MapController=function(){this.map=null,this._objects=[],this.addMarker=function(e){if(this.map){this.map.markers=this.map.markers||{},e.setMap(this.map),e.centered&&this.map.setCenter(e.position);var t=Object.keys(this.map.markers).length;this.map.markers[e.id||t]=e}else this._objects.push(e)},this.addShape=function(e){if(this.map){this.map.shapes=this.map.shapes||{},e.setMap(this.map);var t=Object.keys(this.map.shapes).length;this.map.shapes[e.id||t]=e}else this._objects.push(e)},this.addObject=function(e,t){if(this.map){this.map[e]=this.map[e]||{};var n=Object.keys(this.map[e]).length;this.map[e][t.id||n]=t,"infoWindows"!=e&&t.setMap&&t.setMap(this.map)}else t.groupName=e,this._objects.push(t)},this.addObjects=function(e){for(var t=0;t<e.length;t++){var n=e[t];n instanceof google.maps.Marker?this.addMarker(n):n instanceof google.maps.Circle||n instanceof google.maps.Polygon||n instanceof google.maps.Polyline||n instanceof google.maps.Rectangle||n instanceof google.maps.GroundOverlay?this.addShape(n):this.addObject(n.groupName,n)}}},ngMap.directive("mapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.MapsEngineLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.filter(r),p=t.getOptions(s),l=t.getEvents(e,s,l),c=n(p,l);mapController.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("marker",["Attr2Options",function(e){var t=e,n=function(e,n){var o;if(e.icon instanceof Object){(""+e.icon.path).match(/^[A-Z_]+$/)&&(e.icon.path=google.maps.SymbolPath[e.icon.path]);for(var r in e.icon){var a=e.icon[r];"anchor"==r||"origin"==r?e.icon[r]=new google.maps.Point(a[0],a[1]):("size"==r||"scaledSize"==r)&&(e.icon[r]=new google.maps.Size(a[0],a[1]))}}if(e.position instanceof google.maps.LatLng)o=new google.maps.Marker(e);else{var i=e.position;e.position=new google.maps.LatLng(0,0),o=new google.maps.Marker(e),t.setDelayedGeoLocation(o,"setPosition",i)}Object.keys(n).length>0;for(var s in n)s&&google.maps.event.addListener(o,s,n[s]);return o};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(o),p=t.filter(r),l=t.getOptions(p,e),c=t.getEvents(e,p);o.bind("$destroy",function(){var e=g.map.markers;for(var t in e)e[t]==g&&delete e[t];g.setMap(null)});var g=n(l,c);mapController.addMarker(g),t.observeAttrSetObj(s,r,g)}}}]),ngMap.directive("overlayMapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,n,o,r){for(var a=0;a<r.length;a++)r[a]&&(mapController=r[a]);var i,s=o.initMethod||"insertAt";if(o.object){var p=e[o.object]?e:t;i=p[o.object],"function"==typeof i&&(i=new i)}if(!i)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){if("insertAt"==s){var n=parseInt(o.index,10);t.overlayMapTypes.insertAt(n,i)}else"push"==s&&t.overlayMapTypes.push(i)}),mapController.addObject("overlayMapTypes",i)}}}]),ngMap.directive("shape",["Attr2Options",function(e){var t=e,n=function(e){return new google.maps.LatLngBounds(e[0],e[1])},o=function(e,o){var r,a=e.name;if(delete e.name,e.icons)for(var i=0;i<e.icons.length;i++){var s=e.icons[i];s.icon.path.match(/^[A-Z_]+$/)&&(s.icon.path=google.maps.SymbolPath[s.icon.path])}switch(a){case"circle":if(e.center instanceof google.maps.LatLng)r=new google.maps.Circle(e);else{var p=e.center;e.center=new google.maps.LatLng(0,0),r=new google.maps.Circle(e),t.setDelayedGeoLocation(r,"setCenter",p)}break;case"polygon":r=new google.maps.Polygon(e);break;case"polyline":r=new google.maps.Polyline(e);break;case"rectangle":e.bounds&&(e.bounds=n(e.bounds)),r=new google.maps.Rectangle(e);break;case"groundOverlay":case"image":var l=e.url,c=n(e.bounds),g={opacity:e.opacity,clickable:e.clickable,id:e.id};r=new google.maps.GroundOverlay(l,c,g)}for(var u in o)o[u]&&google.maps.event.addListener(r,u,o[u]);return r};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,n,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(n),p=t.filter(r),l=t.getOptions(p),c=t.getEvents(e,p),g=o(l,c);mapController.addShape(g),t.observeAttrSetObj(s,r,g)}}}]),ngMap.directive("trafficLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TrafficLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(o),p=t.filter(r),l=t.getOptions(p),c=t.getEvents(e,p),g=n(l,c);mapController.addObject("trafficLayers",g),t.observeAttrSetObj(s,r,g)}}}]),ngMap.directive("transitLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TransitLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(o),p=t.filter(r),l=t.getOptions(p),c=t.getEvents(e,p),g=n(l,c);mapController.addObject("transitLayers",g),t.observeAttrSetObj(s,r,g)}}}]),ngMap.directive("weatherLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.WeatherLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:["^?map","?^ngMap"],link:function(e,o,r,a){for(var i=0;i<a.length;i++)a[i]&&(mapController=a[i]);var s=t.orgAttributes(o),p=t.filter(r),l=t.getOptions(p),c=t.getEvents(e,p),g=n(l,c);mapController.addObject("weatherLayers",g),t.observeAttrSetObj(s,r,g)}}}]);